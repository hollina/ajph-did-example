{
  "hash": "4aa462d677dbc12691b868bc2364991e",
  "result": {
    "markdown": "---\ntitle: \"Antibiotics and mortality\"\nformat: \n  html:\n    self-contained: true\n---\n\n\n## Load packages\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: pacman\n```\n:::\n:::\n\n\n## Load AEJ-Applied data\n\nLet's start by loading in the simplest data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_mortality = haven::read_dta(\"data/raw/113743-V1/AEJApp-20080229_Datasets/20080229_state_data.dta\")\nstate_mortality = as.data.table(state_mortality)\n#state_mortality[,infl_pneumonia_rate:= infl_pneumonia_rate*3]\n\n\nnational_mortality = haven::read_dta(\"data/raw/113743-V1/AEJApp-20080229_Datasets/20080229_national_data.dta\")\nnational_mortality = as.data.table(national_mortality)\nnational_mortality[,one:=1]\nnational_mortality[,two:=2]\n```\n:::\n\n\nQuick look at the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflu_plot = ggplot(data = subset(national_mortality, year >= 1928), aes(x = year, y = (influenza_pneumonia_total), shape = as.factor(one))) + \n    geom_point(size = 3, alpha = .75) + \n    theme_classic(base_size = 14) +\n    geom_vline(xintercept = 1937, linetype=\"dashed\") +\n    labs(title = \"Influenza and pneumonia mortality rate across time\", \n         y = \"\", \n         subtitle = \"Death rate per 100,000\",\n         x = \"Year\") +\n    theme(legend.position = \"none\") \n\nflu_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nflu_plot +\n    geom_point(data = national_mortality, aes(x = year, y = (tuberculosis_total), shape = as.factor(two)), size = 3, alpha = .75) +\n        theme_classic(base_size = 14) +\n    labs(title = \"Mortality rate across time\", \n         y = \"\", \n         subtitle = \"Death rate per 100,000\",\n         x = \"Year\") +\n      scale_shape_manual(name = \"\", values=c(16, 17), labels = c(\"Influenza/pneumonia\", \"Tuberculosis\"),  guide = 'legend') + \n  theme(legend.position = c(.8, 1))\n```\n:::\n\n\n## Do simple diff in diff.\n\nReshape the data, call treatment 1937 and after, create post $\\times$ treat variable.\n\n\n::: {.cell}\n\n:::\n\n\nRun simple DiD\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\nNOTE: 96 observations removed because of NA values (LHS: 96).\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\\begingroup\n\\centering\n\\begin{tabular}{lc}\n   \\tabularnewline \\midrule \\midrule\n   Dependent Variable: & log(value)\\\\  \n   Model:              & (1)\\\\  \n   \\midrule\n   \\emph{Variables}\\\\\n   treated             & -0.0632$^{***}$\\\\   \n                       & ($2.37\\times 10^{-8}$)\\\\    \n   \\midrule\n   \\emph{Fixed-effects}\\\\\n   treated\\_disease    & Yes\\\\  \n   state\\_pc           & Yes\\\\  \n   year                & Yes\\\\  \n   \\midrule\n   \\emph{Fit statistics}\\\\\n   Observations        & 2,696\\\\  \n   R$^2$               & 0.87465\\\\  \n   Within R$^2$        & 0.00505\\\\  \n   \\midrule \\midrule\n   \\multicolumn{2}{l}{\\emph{Clustered (treated\\_disease) standard-errors in parentheses}}\\\\\n   \\multicolumn{2}{l}{\\emph{Signif. Codes: ***: 0.01, **: 0.05, *: 0.1}}\\\\\n\\end{tabular}\n\\par\\endgroup\n```\n:::\n:::\n\n\nShow the results\n\n\n::: {.cell}\n\n```{.r .cell-code}\netable(simple_did)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                          simple_did\nDependent Var.:           log(value)\n                                    \ntreated         -0.0632*** (2.37e-8)\nFixed-Effects:  --------------------\ntreated_disease                  Yes\nstate_pc                         Yes\nyear                             Yes\n_______________ ____________________\nS.E.: Clustered  by: treated_disease\nObservations                   2,696\nR2                           0.87465\nWithin R2                    0.00505\n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\neffect = 1*simple_did$coeftable[1,1]*mean(state_mortality$infl_pneumonia_rate, na.rm = TRUE)\n```\n:::\n\n\n# Create fake data\n\nAdd random variable to each state to get fake treated_year\n\nFirst create percentiles\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquantiles = state_mortality[year == 1928, .(untreated = quantile(infl_pneumonia_rate, 0.25, na.rm = TRUE), low = quantile(infl_pneumonia_rate, 0.5, na.rm = TRUE), high = quantile(infl_pneumonia_rate, 0.75, na.rm = TRUE))]\n```\n:::\n\n\nUse these percentiles to create cutoffs in fake treatment.\n\n-   Lowest 25% is \"never treated\"\n\n-   25-50% is early\n\n-   50-75% is middle\n\n-   75%+ is late\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_mortality[year == 1928, fake_year_treated := ifelse(infl_pneumonia_rate <= quantiles$untreated, 2020, ifelse(infl_pneumonia_rate > quantiles$untreated & infl_pneumonia_rate <= quantiles$low, 1945,\n                                     ifelse(infl_pneumonia_rate > quantiles$low & infl_pneumonia_rate <= quantiles$high, 1940, 1930)))]\n\nstate_mortality = state_mortality[, fake_year_treated := fake_year_treated[year == 1928], by = state_pc]\n```\n:::\n\n\nFor the fake data, we will use real pre-1930 trends.\n\nGet pre-treatment trend and s.d.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_trend_inf = fixest::feols(log(infl_pneumonia_rate)  ~ year | 1, \n              data = subset(state_mortality, year < 1937 & year > 1927))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNOTE: 2 observations removed because of NA values (LHS: 2).\n```\n:::\n\n```{.r .cell-code}\netable(state_trend_inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         state_trend_inf\nDependent Var.: log(infl_pneumonia_rate)\n                                        \nConstant                47.03*** (8.902)\nyear                 -0.0278*** (0.0046)\n_______________ ________________________\nS.E. type                            IID\nObservations                         421\nR2                               0.08020\nAdj. R2                          0.07801\n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncoef_inf = -state_trend_inf$coeftable[2,1]*mean(state_mortality$infl_pneumonia_rate, na.rm = TRUE)/3\n#coef_inf = 0\nse_inf = state_trend_inf$coeftable[2,2]\n```\n:::\n\n\n# Create fake data\n\n## Staggered adoption and growing treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Keep only the variables that we need from 1928\ntiming_yes_growing_yes = state_mortality[year == 1928,.(state_pc, infl_pneumonia_rate, fake_year_treated, pop3)]\n\n# Expand the dataset to be from 1928 until 1950\nfull_state_year_grid = data.table(expand.grid(year=1928:1950, state_pc =unique(timing_yes_growing_yes$state_pc)))\n\nscale = 15\n# Create error\nfull_state_year_grid[,rand_e:=1-rlnorm(.N, 0.00091/scale, 0.0004346585/scale)]\nfull_state_year_grid[year == 1928, rand_st:=1-rlnorm(.N, 0.00091/scale, 0.0004346585/scale)]\nfull_state_year_grid[state_pc == \"AL\", rand_yr:=1-rlnorm(.N, 0.00091/scale, 0.0004346585/scale)]\n\n#full_state_year_grid[,rand_e:=0]\n#full_state_year_grid[year == 1928, rand_st:=0]\n#full_state_year_grid[state_pc == \"AL\", rand_yr:=0]\n\nfull_state_year_grid = full_state_year_grid[, rand_st := rand_st[year == 1928], by = state_pc]\nfull_state_year_grid = full_state_year_grid[, rand_yr := rand_yr[state_pc == \"AL\"], by = year]\n\n# Merge the two togethers\ntiming_yes_growing_yes = merge(timing_yes_growing_yes, full_state_year_grid, by = \"state_pc\")\n\n# Add fake treatment status in each year\ntiming_yes_growing_yes[, treated := ifelse(year >= fake_year_treated, 1, 0)]\n\n# Add \"natural\" slope from pre-trend\ntiming_yes_growing_yes[, fake_value := (infl_pneumonia_rate - (year-1928)*coef_inf) + .1*rand_st + .05*rand_yr + .1*rand_e]\n\n# Add treatment effect\ntiming_yes_growing_yes[, fake_value := ifelse(fake_year_treated == 1940, fake_value + effect*treated + (.0005*simple_did$coeftable[1,1]*(year - fake_year_treated)*treated), ifelse(fake_year_treated == 1945, fake_value + effect*treated + (.0002*simple_did$coeftable[1,1]*(year - fake_year_treated)*treated),fake_value + effect*treated + (.0015*simple_did$coeftable[1,1]*(year - fake_year_treated)*treated)))]\n\n# Bound at zero\ntiming_yes_growing_yes[, fake_value := ifelse(fake_value < 0, 0, fake_value)]\n\n# Collapse into timing groups\ntiming_yes_growing_yes_collapsed = collap(timing_yes_growing_yes, ~ year + fake_year_treated, fmean, cols = 10, w = timing_yes_growing_yes$pop3)\n```\n:::\n\n\n## Staggered adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Keep only the variables that we need from 1928\ntiming_yes_growing_no = state_mortality[year == 1928,.(state_pc, infl_pneumonia_rate, fake_year_treated, pop3)]\n\n# Merge the two togethers\ntiming_yes_growing_no = merge(timing_yes_growing_no, full_state_year_grid, by = \"state_pc\")\n\n# Add fake treatment status in each year\ntiming_yes_growing_no[, treated := ifelse(year >= fake_year_treated, 1, 0)]\n\n# Add \"natural\" slope from pre-trend\ntiming_yes_growing_no[, fake_value := (infl_pneumonia_rate - (year-1928)*coef_inf) + .1*rand_st + .05*rand_yr + .1*rand_e]\n\n# Add treatment effect\ntiming_yes_growing_no[, fake_value := fake_value + effect*treated]\n\n# Bound at zero\ntiming_yes_growing_no[, fake_value := ifelse(fake_value < 0, 0, fake_value)]\n\n# Collapse into timing groups\ntiming_yes_growing_no_collapsed = collap(timing_yes_growing_no, ~ year + fake_year_treated, fmean, cols = 10, w = timing_yes_growing_yes$pop3)\n```\n:::\n\n\n## Same adoption and growing treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Keep only the variables that we need from 1928\ntiming_no_growing_yes = state_mortality[year == 1928,.(state_pc, infl_pneumonia_rate, fake_year_treated, pop3)]\n\n# Replace fake treatment status for ever treated years\ntiming_no_growing_yes[, fake_year_treated := ifelse(fake_year_treated < 1950, 1937, fake_year_treated)]\n\n# Merge the two togethers\ntiming_no_growing_yes = merge(timing_no_growing_yes, full_state_year_grid, by = \"state_pc\")\n\n# Add fake treatment status in each year\ntiming_no_growing_yes[, treated := ifelse(year >= fake_year_treated, 1, 0)]\n\n# Add \"natural\" slope from pre-trend\ntiming_no_growing_yes[, fake_value := (infl_pneumonia_rate - (year-1928)*coef_inf) + .1*rand_st + .05*rand_yr + .1*rand_e]\n\n# Add treatment effect\ntiming_no_growing_yes[, fake_value := ifelse(fake_year_treated == 1940, fake_value + effect*treated + (.0005*simple_did$coeftable[1,1]*(year - fake_year_treated)*treated), ifelse(fake_year_treated == 1945, fake_value + effect*treated + (.0002*simple_did$coeftable[1,1]*(year - fake_year_treated)*treated),fake_value + effect*treated + (.0015*simple_did$coeftable[1,1]*(year - fake_year_treated)*treated)))]\n\n# Bound at zero\ntiming_no_growing_yes[, fake_value := ifelse(fake_value < 0, 0, fake_value)]\n\n# Collapse into timing groups\ntiming_no_growing_yes_collapsed = collap(timing_no_growing_yes, ~ year + fake_year_treated, fmean, cols = 10, w = timing_yes_growing_yes$pop3)\n```\n:::\n\n\n## Same adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Keep only the variables that we need from 1928\ntiming_no_growing_no = state_mortality[year == 1928,.(state_pc, infl_pneumonia_rate, fake_year_treated, pop3)]\n\n# Replace fake treatment status for ever treated years\ntiming_no_growing_no[, fake_year_treated := ifelse(fake_year_treated < 1950, 1937, fake_year_treated)]\n\n# Merge the two togethers\ntiming_no_growing_no = merge(timing_no_growing_no, full_state_year_grid, by = \"state_pc\")\n\n# Add fake treatment status in each year\ntiming_no_growing_no[, treated := ifelse(year >= fake_year_treated, 1, 0)]\n\n# Add \"natural\" slope from pre-trend\ntiming_no_growing_no[, fake_value := (infl_pneumonia_rate - (year-1928)*coef_inf) + .1*rand_st + .05*rand_yr + .1*rand_e]\n\n# Add treatment effect\ntiming_no_growing_no[, fake_value := fake_value + effect*treated]\n\n# Bound at zero\ntiming_no_growing_no[, fake_value := ifelse(fake_value < 0, 0, fake_value)]\n\n# Collapse into timing groups\ntiming_no_growing_no_collapsed = collap(timing_no_growing_no, ~ year + fake_year_treated, fmean, cols = 10, w = timing_yes_growing_yes$pop3)\n```\n:::\n\n\n\n## Plot each group.\n\n### Staggered adoption and dynamic treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes_plot = ggplot(data = timing_yes_growing_yes_collapsed,\n                                    aes(x = year, y = (fake_value)*100000, shape = as.factor(fake_year_treated))) + \n    geom_point(size = 3, alpha = 1) + \n    theme_classic(base_size = 14) +\n    geom_vline(xintercept = 1944.5, linetype=\"dashed\") +\n    geom_vline(xintercept = 1929.5, linetype=\"dashed\") +\n    geom_vline(xintercept = 1939.5, linetype=\"dashed\") +\n    labs(title = \"Fake treatment, staggered adoption, growing treatment\", \n         y = \"\", \n         subtitle = \"Influenza/pneumonia mortality death rate per 100,000\",\n         x = \"Year\") +\n      scale_shape_manual(name = \"\", \n                         values=c(15, 16, 17, 4), \n                         labels = c(\"Early\", \n                                    \"Middle\", \n                                    \"Late\", \n                                    \"Never\"),  \n                         guide = 'legend') + \n  theme(legend.position = c(.9, .9))\ntiming_yes_growing_yes_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n### Staggered adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_no_plot = ggplot(data = timing_yes_growing_no_collapsed,\n                                    aes(x = year, y = (fake_value)*100000, shape = as.factor(fake_year_treated))) + \n    geom_point(size = 3, alpha = 1) + \n    theme_classic(base_size = 14) +\n    geom_vline(xintercept = 1944.5, linetype=\"dashed\") +\n    geom_vline(xintercept = 1929.5, linetype=\"dashed\") +\n    geom_vline(xintercept = 1939.5, linetype=\"dashed\") +\n    labs(title = \"Fake treatment, staggered adoption, stable treatment\", \n         y = \"\", \n         subtitle = \"Influenza/pneumonia mortality death rate per 100,000\",\n         x = \"Year\") +\n      scale_shape_manual(name = \"\", \n                         values=c(15, 16, 17, 4), \n                         labels = c(\"Early\", \n                                    \"Middle\", \n                                    \"Late\", \n                                    \"Never\"),  \n                         guide = 'legend') + \n  theme(legend.position = c(.9, .9))\ntiming_yes_growing_no_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n### Same adoption and dynamic treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_yes_plot = ggplot(data = timing_no_growing_yes_collapsed,\n                                    aes(x = year, y = (fake_value)*100000, shape = as.factor(fake_year_treated))) + \n    geom_point(size = 3, alpha = 1) + \n    theme_classic(base_size = 14) +\n    geom_vline(xintercept = 1936.5, linetype=\"dashed\") +\n    labs(title = \"Fake treatment, non-staggered adoption, growing treatment\", \n         y = \"\", \n         subtitle = \"Influenza/pneumonia mortality death rate per 100,000\",\n         x = \"Year\") +\n      scale_shape_manual(name = \"\", \n                         values=c(15, 4), \n                         labels = c(\"1937\", \n                                    \"Never\"),  \n                         guide = 'legend') + \n  theme(legend.position = c(.9, .9))\ntiming_no_growing_yes_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n### Same adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_no_plot = ggplot(data = timing_no_growing_no_collapsed,\n                                    aes(x = year, y = (fake_value)*100000, shape = as.factor(fake_year_treated))) + \n    geom_point(size = 3, alpha = 1) + \n    theme_classic(base_size = 14) +\n    geom_vline(xintercept = 1936.5, linetype=\"dashed\") +\n    labs(title = \"Fake treatment, non-staggered adoption, stable treatment\", \n         y = \"\", \n         subtitle = \"Influenza/pneumonia mortality death rate per 100,000\",\n         x = \"Year\") +\n      scale_shape_manual(name = \"\", \n                         values=c(15, 4), \n                         labels = c(\"1937\", \n                                    \"Never\"),  \n                         guide = 'legend') + \n  theme(legend.position = c(.9, .9))\ntiming_no_growing_no_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n## Run naive twoway FE regressions\n\n### Staggered adoption and dynamic treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes_did = fixest::feols((fake_value)*100000 ~ treated | state_pc + year, data = timing_yes_growing_yes)\n\n# Estimate of the treatment effect is \ntiming_yes_growing_yes_did$coeftable[1,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4.529145\n```\n:::\n\n```{.r .cell-code}\n# Real treatment effect is initial \nprint(effect)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.00005774065\n```\n:::\n\n```{.r .cell-code}\n# Then grows by this each year. \nprint(simple_did$coeftable[1,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.06316098\n```\n:::\n:::\n\n### Staggered adoption and stable treatment effect.\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_no_did = fixest::feols((fake_value)*100000 ~ treated | state_pc + year, data = timing_yes_growing_no)\n\n# Estimate of the treatment effect is \ntiming_yes_growing_no_did$coeftable[1,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -5.783851\n```\n:::\n\n```{.r .cell-code}\n# Real treatment effect is initial \nprint(effect)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.00005774065\n```\n:::\n\n```{.r .cell-code}\n# Then grows by this each year. \nprint(0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n:::\n\n\n### Same adoption and dynamic treatment effect.\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_yes_did = fixest::feols((fake_value)*100000 ~ treated | state_pc + year, data = timing_no_growing_yes)\n\n# Estimate of the treatment effect is \ntiming_no_growing_yes_did$coeftable[1,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -66.81085\n```\n:::\n\n```{.r .cell-code}\n# Real treatment effect is \nprint(effect)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.00005774065\n```\n:::\n\n```{.r .cell-code}\n# Then grows by this each year. \nprint(simple_did$coeftable[1,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.06316098\n```\n:::\n:::\n\n### Same adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_no_did = fixest::feols((fake_value)*100000 ~ treated | state_pc + year, data = timing_no_growing_no)\n\n# Estimate of the treatment effect is \ntiming_no_growing_no_did$coeftable[1,1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -5.825282\n```\n:::\n\n```{.r .cell-code}\n# Real treatment effect is \nprint(effect)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.00005774065\n```\n:::\n\n```{.r .cell-code}\n# Then grows by this each year. \nprint(0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n:::\n\n\n### Table showing results\n\n::: {.cell}\n\n```{.r .cell-code}\netable(timing_no_growing_no_did, timing_no_growing_yes_did, timing_yes_growing_no_did, timing_yes_growing_yes_did)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                timing_no_growing.. timing_no_growing...1 timing_yes_growin..\nDependent Var.: (fake_value)*100000   (fake_value)*100000 (fake_value)*100000\n                                                                             \ntreated          -5.825*** (0.0406)    -66.81*** (0.1346)  -5.784*** (0.0375)\nFixed-Effects:  -------------------   ------------------- -------------------\nstate_pc                        Yes                   Yes                 Yes\nyear                            Yes                   Yes                 Yes\n_______________ ___________________   ___________________ ___________________\nS.E.: Clustered        by: state_pc          by: state_pc        by: state_pc\nObservations                  1,012                 1,012               1,012\nR2                          0.99989               0.92801             0.99988\nWithin R2                   0.95103               0.55321             0.96890\n\n                timing_yes_growin...1\nDependent Var.:   (fake_value)*100000\n                                     \ntreated                 4.529 (5.519)\nFixed-Effects:    -------------------\nstate_pc                          Yes\nyear                              Yes\n_______________   ___________________\nS.E.: Clustered          by: state_pc\nObservations                    1,012\nR2                            0.64927\nWithin R2                     0.00289\n---\nSignif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Run naive twoway FE event-studies\n\nCreate event study data. \n\n\n\n### Same adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhigh_cap = 8\nlow_cap = -8\n#state_pc, year, high_cap, low_cap, timing_no_growing_no\n# id, time, high_cap, low_cap, dataset\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a temporary dataset that creates \"event-time\" and caps this variable. \n    # Never treated units get set to -1\ntemp = timing_yes_growing_yes[treated == 1, .SD[which.min(year)], by = state_pc][,first_time := year][,.(state_pc, first_time)]\n\ntemp = merge(temp, timing_yes_growing_yes, all.y = TRUE)\n\ntemp[, event_time := year - first_time][,event_time_capped := ifelse(event_time > high_cap,  high_cap + 1, ifelse( event_time < low_cap,  low_cap - 1, event_time))][,event_time_capped := ifelse(is.na(event_time), -1, event_time_capped)]\n\n# Create a list of unique levels of the capped event-time variable\nunique_vals = levels(as.factor(temp$event_time_capped))\n    \n# Remove -1 event-time (so it will be forced to be reference group)\nunique_vals = unique_vals[!(unique_vals == -1)]\n\n\n# Create a dummy variable matrix. \n    # Note this is strictly binary \n        # You could imagine wanting NA values \n        # (e.g., can you know if T-5 is really zero or one if the current year is 2020 and the data year is 2019?)\n            # Technically this should be NA IMO. \n    # Fill in the 1's\n    for (i in unique_vals) {\n        temp[event_time_capped == i, paste0('_T', i) := 1]\n    }\n    # Fill in the zeros\n    for (i in seq(ncol(temp)-length(unique_vals)+1,ncol(temp))) set(temp, i=which(is.na(temp[[i]])), j=i, value=0)\n      \ntiming_yes_growing_yes_es_data = temp\n```\n:::\n\n\n\n\n### Staggered adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhigh_cap = 8\nlow_cap = -8\n#state_pc, year, high_cap, low_cap, timing_no_growing_no\n# id, time, high_cap, low_cap, dataset\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a temporary dataset that creates \"event-time\" and caps this variable. \n    # Never treated units get set to -1\ntemp = timing_yes_growing_no[treated == 1, .SD[which.min(year)], by = state_pc][,first_time := year][,.(state_pc, first_time)]\n\ntemp = merge(temp, timing_yes_growing_no, all.y = TRUE)\n\ntemp[, event_time := year - first_time][,event_time_capped := ifelse(event_time > high_cap,  high_cap + 1, ifelse( event_time < low_cap,  low_cap - 1, event_time))][,event_time_capped := ifelse(is.na(event_time), -1, event_time_capped)]\n\n# Create a list of unique levels of the capped event-time variable\nunique_vals = levels(as.factor(temp$event_time_capped))\n    \n# Remove -1 event-time (so it will be forced to be reference group)\nunique_vals = unique_vals[!(unique_vals == -1)]\n\n\n# Create a dummy variable matrix. \n    # Note this is strictly binary \n        # You could imagine wanting NA values \n        # (e.g., can you know if T-5 is really zero or one if the current year is 2020 and the data year is 2019?)\n            # Technically this should be NA IMO. \n    # Fill in the 1's\n    for (i in unique_vals) {\n        temp[event_time_capped == i, paste0('_T', i) := 1]\n    }\n    # Fill in the zeros\n    for (i in seq(ncol(temp)-length(unique_vals)+1,ncol(temp))) set(temp, i=which(is.na(temp[[i]])), j=i, value=0)\n      \ntiming_yes_growing_no_es_data = temp\n```\n:::\n\n\n\n### Same adoption and growing treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhigh_cap = 8\nlow_cap = -8\n#state_pc, year, high_cap, low_cap, timing_no_growing_no\n# id, time, high_cap, low_cap, dataset\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a temporary dataset that creates \"event-time\" and caps this variable. \n    # Never treated units get set to -1\ntemp = timing_no_growing_yes[treated == 1, .SD[which.min(year)], by = state_pc][,first_time := year][,.(state_pc, first_time)]\n\ntemp = merge(temp, timing_no_growing_yes, all.y = TRUE)\n\ntemp[, event_time := year - first_time][,event_time_capped := ifelse(event_time > high_cap,  high_cap + 1, ifelse( event_time < low_cap,  low_cap - 1, event_time))][,event_time_capped := ifelse(is.na(event_time), -1, event_time_capped)]\n\n# Create a list of unique levels of the capped event-time variable\nunique_vals = levels(as.factor(temp$event_time_capped))\n    \n# Remove -1 event-time (so it will be forced to be reference group)\nunique_vals = unique_vals[!(unique_vals == -1)]\n\n\n# Create a dummy variable matrix. \n    # Note this is strictly binary \n        # You could imagine wanting NA values \n        # (e.g., can you know if T-5 is really zero or one if the current year is 2020 and the data year is 2019?)\n            # Technically this should be NA IMO. \n    # Fill in the 1's\n    for (i in unique_vals) {\n        temp[event_time_capped == i, paste0('_T', i) := 1]\n    }\n    # Fill in the zeros\n    for (i in seq(ncol(temp)-length(unique_vals)+1,ncol(temp))) set(temp, i=which(is.na(temp[[i]])), j=i, value=0)\n      \ntiming_no_growing_yes_es_data = temp\n```\n:::\n\n\n\n### Same adoption and stable treatment effect.\n\n::: {.cell}\n\n```{.r .cell-code}\nhigh_cap = 8\nlow_cap = -8\n#state_pc, year, high_cap, low_cap, timing_no_growing_no\n# id, time, high_cap, low_cap, dataset\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a temporary dataset that creates \"event-time\" and caps this variable. \n    # Never treated units get set to -1\ntemp = timing_no_growing_no[treated == 1, .SD[which.min(year)], by = state_pc][,first_time := year][,.(state_pc, first_time)]\n\ntemp = merge(temp, timing_no_growing_no, all.y = TRUE)\n\ntemp[, event_time := year - first_time][,event_time_capped := ifelse(event_time > high_cap,  high_cap + 1, ifelse( event_time < low_cap,  low_cap - 1, event_time))][,event_time_capped := ifelse(is.na(event_time), -1, event_time_capped)]\n\n# Create a list of unique levels of the capped event-time variable\nunique_vals = levels(as.factor(temp$event_time_capped))\n    \n# Remove -1 event-time (so it will be forced to be reference group)\nunique_vals = unique_vals[!(unique_vals == -1)]\n\n\n# Create a dummy variable matrix. \n    # Note this is strictly binary \n        # You could imagine wanting NA values \n        # (e.g., can you know if T-5 is really zero or one if the current year is 2020 and the data year is 2019?)\n            # Technically this should be NA IMO. \n    # Fill in the 1's\n    for (i in unique_vals) {\n        temp[event_time_capped == i, paste0('_T', i) := 1]\n    }\n    # Fill in the zeros\n    for (i in seq(ncol(temp)-length(unique_vals)+1,ncol(temp))) set(temp, i=which(is.na(temp[[i]])), j=i, value=0)\n      \ntiming_no_growing_no_es_data = temp\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n## Run the event studies\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes_es_results = event_study_regression(dataset = timing_yes_growing_yes_es_data,\n               id = state_pc,\n               time = year,\n               treated = \"treated\",\n               y_var = \"(fake_value)*100000\",\n               dd_control_list = NULL,\n               control_list = NULL,\n               fixed_effects = \"state_pc + year\",\n               cluster_var = state_pc, \n               low_cap = -8,\n               high_cap = 8)\n\ntiming_yes_growing_no_es_results = event_study_regression(dataset = timing_yes_growing_no_es_data,\n               id = state_pc,\n               time = year,\n               treated = \"treated\",\n               y_var = \"(fake_value)*100000\",\n               dd_control_list = NULL,\n               control_list = NULL,\n               fixed_effects = \"state_pc + year\",\n               cluster_var = state_pc, \n               low_cap = -8,\n               high_cap = 8)\n\ntiming_no_growing_yes_es_results = event_study_regression(dataset = timing_no_growing_yes_es_data,\n               id = state_pc,\n               time = year,\n               treated = \"treated\",\n               y_var = \"(fake_value)*100000\",\n               dd_control_list = NULL,\n               control_list = NULL,\n               fixed_effects = \"state_pc + year\",\n               cluster_var = state_pc, \n               low_cap = -8,\n               high_cap = 8)\n\n\ntiming_no_growing_no_es_results = event_study_regression(dataset = timing_no_growing_no_es_data,\n               id = state_pc,\n               time = year,\n               treated = \"treated\",\n               y_var = \"(fake_value)*100000\",\n               dd_control_list = NULL,\n               control_list = NULL,\n               fixed_effects = \"state_pc + year\",\n               cluster_var = state_pc, \n               low_cap = -8,\n               high_cap = 8)\n```\n:::\n\n\n## Plot naive event studies\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes_es_plot = plot_event_study(event_study_results = timing_yes_growing_yes_es_results,\n                                     low_cap = -8,\n                                     high_cap = 8,\n                                     breaks = 1, \n                                     plot_title = \"Yes timing, Yes growth\", \n                                     x_title = \"Years since sulfa discovery\", \n                                     plot_subtitle = \"Percent change in death rate\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n```{.r .cell-code}\ntiming_yes_growing_yes_es_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_no_es_plot = plot_event_study(event_study_results = timing_yes_growing_no_es_results,\n                                     low_cap = -8,\n                                     high_cap = 8,\n                                     breaks = 1, \n                                     plot_title = \"Yes timing, No growth\", \n                                     x_title = \"Years since sulfa discovery\", \n                                     plot_subtitle = \"Percent change in death rate\")\ntiming_yes_growing_no_es_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_yes_es_plot = plot_event_study(event_study_results = timing_no_growing_yes_es_results,\n                                     low_cap = -8,\n                                     high_cap = 8,\n                                     breaks = 1, \n                                     plot_title = \"No timing, Yes growth\", \n                                     x_title = \"Years since sulfa discovery\", \n                                     plot_subtitle = \"Percent change in death rate\")\ntiming_no_growing_yes_es_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_no_es_plot = plot_event_study(event_study_results = timing_no_growing_no_es_results,\n                                     low_cap = -8,\n                                     high_cap = 8,\n                                     breaks = 1, \n                                     plot_title = \"No timing, no growth\", \n                                     x_title = \"Years since sulfa discovery\", \n                                     plot_subtitle = \"Percent change in death rate\")\n\ntiming_no_growing_no_es_plot\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\n# Bacon decomp\n\n### Staggered adoption and growing treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes[,ln_fake_value := (fake_value)*100000]\n\ntiming_yes_growing_yes_bacon = bacon(ln_fake_value ~ treated,\n                  data = as.data.frame(timing_yes_growing_yes),\n                  id_var = \"state_pc\",\n                  time_var = \"year\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                      type  weight   avg_est\n1 Earlier vs Later Treated 0.17857 -34.97062\n2 Later vs Earlier Treated 0.37338  62.72727\n3     Treated vs Untreated 0.44805 -28.22663\n```\n:::\n\n```{.r .cell-code}\n# weighted average of the decomposition\nsum(timing_yes_growing_yes_bacon$estimate * timing_yes_growing_yes_bacon$weight)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4.529145\n```\n:::\n\n```{.r .cell-code}\nggplot(timing_yes_growing_yes_bacon) +\n  aes(x = weight, y = estimate, shape = factor(type)) +\n  geom_point() +\n  geom_hline(yintercept = 0) + \n  theme_minimal() +\n  labs(x = \"Weight\", y = \"Estimate\", shape = \"Type\")\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n### Staggered adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_no[,ln_fake_value := (fake_value)*100000]\n\ntiming_yes_growing_no_bacon = bacon(ln_fake_value ~ treated,\n                  data = as.data.frame(timing_yes_growing_no),\n                  id_var = \"state_pc\",\n                  time_var = \"year\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                      type  weight  avg_est\n1 Earlier vs Later Treated 0.17857 -5.68689\n2 Later vs Earlier Treated 0.37338 -5.77707\n3     Treated vs Untreated 0.44805 -5.82814\n```\n:::\n\n```{.r .cell-code}\nggplot(timing_yes_growing_no_bacon) +\n  aes(x = weight, y = estimate, shape = factor(type)) +\n  geom_point() +\n  geom_hline(yintercept = 0) + \n  theme_minimal() +\n  labs(x = \"Weight\", y = \"Estimate\", shape = \"Type\")\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n### Same adoption and growing treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_yes[,ln_fake_value := (fake_value)*100000]\n\ntiming_no_growing_yes_bacon = bacon(ln_fake_value ~ treated,\n                  data = as.data.frame(timing_no_growing_yes),\n                  id_var = \"state_pc\",\n                  time_var = \"year\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  type weight   avg_est\n1 Treated vs Untreated      1 -66.81085\n```\n:::\n\n```{.r .cell-code}\nggplot(timing_no_growing_yes_bacon) +\n  aes(x = weight, y = estimate, shape = factor(type)) +\n  geom_point() +\n  geom_hline(yintercept = 0) + \n  theme_minimal() +\n  labs(x = \"Weight\", y = \"Estimate\", shape = \"Type\")\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n### Same adoption and stable treatment effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_no_growing_no[,ln_fake_value := (fake_value)*100000]\n\ntiming_no_growing_no_bacon = bacon(ln_fake_value ~ treated,\n                  data = as.data.frame(timing_no_growing_no),\n                  id_var = \"state_pc\",\n                  time_var = \"year\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  type weight  avg_est\n1 Treated vs Untreated      1 -5.82528\n```\n:::\n\n```{.r .cell-code}\nggplot(timing_no_growing_no_bacon) +\n  aes(x = weight, y = estimate, shape = factor(type)) +\n  geom_point() +\n  geom_hline(yintercept = 0) + \n  theme_minimal() +\n  labs(x = \"Weight\", y = \"Estimate\", shape = \"Type\")\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes_feols = timing_yes_growing_yes\n\n\n\ntiming_yes_growing_yes_feols[, event_time := year - fake_year_treated]\n\ntiming_yes_growing_yes_feols[, event_time := ifelse(fake_year_treated == 2020, -1, event_time)]\n\nmod_twfe = feols(fake_value*100000 ~ i(event_time, ref = -1)  ## Our key interaction: time × treatment status\n          |                    ## Other controls\n          state_pc + year,                             ## FEs\n         cluster = ~state_pc,                          ## Clustered SEs\n         data = timing_yes_growing_yes_feols)\n\niplot(mod_twfe, \n      xlab = 'Time to treatment',\n      main = 'Event study: Staggered treatment (TWFE)')\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_sa = feols(fake_value*100000 ~ sunab(fake_year_treated, year)  ## Our key interaction: time × treatment status\n\t\t  |                    ## Other controls\n\t\t  state_pc + year,                             ## FEs\n\t\t cluster = ~state_pc,                          ## Clustered SEs\n\t\t data = timing_yes_growing_yes_es_data)\nsummary(mod_sa, agg = \"ATT\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: fake_value * 100000\nObservations: 1,012 \nFixed-effects: state_pc: 44,  year: 23\nStandard-errors: Clustered (state_pc) \n    Estimate Std. Error  t value  Pr(>|t|)    \nATT -60.5326   0.462914 -130.764 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.5342     Adj. R2: 0.994976\n               Within R2: 0.987567\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\niplot(list(mod_twfe, mod_sa), sep = 0.5, ref.line = -1,\n      xlab = 'Time to treatment',\n      main = 'Event study: Staggered treatment')\nlegend(\"bottomleft\", col = c(1, 2), pch = c(20, 17), \n       legend = c(\"TWFE\", \"Sun & Abraham (2020)\"))\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\n\n## CS\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntiming_yes_growing_yes_cs = timing_yes_growing_yes\n\ntiming_yes_growing_yes_cs[,fake_value2 := fake_value*100000]\ntiming_yes_growing_yes_cs[,state_group := as.numeric(as.factor(state_pc))]\ntiming_yes_growing_yes_cs[,fake_year_treated2 := ifelse(fake_year_treated == 2020, 0, fake_year_treated)]\n\nexample_attgt <- att_gt(yname = \"fake_value2\",\n                        tname = \"year\",\n                        idname = \"state_group\",\n                        gname = \"fake_year_treated2\",\n                        xformla = ~1,\n                        data = timing_yes_growing_yes_cs\n                        )\nsummary(example_attgt)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\natt_gt(yname = \"fake_value2\", tname = \"year\", idname = \"state_group\", \n    gname = \"fake_year_treated2\", xformla = ~1, data = timing_yes_growing_yes_cs)\n\nReference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> \n\nGroup-Time Average Treatment Effects:\n Group Time  ATT(g,t) Std. Error [95% Simult.  Conf. Band]  \n  1930 1929    0.0612     0.1843       -0.4875      0.6098  \n  1930 1930   -5.8218     0.1856       -6.3743     -5.2693 *\n  1930 1931  -15.0341     0.1854      -15.5860    -14.4821 *\n  1930 1932  -24.6100     0.1279      -24.9909    -24.2292 *\n  1930 1933  -34.1836     0.1797      -34.7184    -33.6488 *\n  1930 1934  -43.8430     0.1743      -44.3619    -43.3241 *\n  1930 1935  -53.1676     0.2108      -53.7949    -52.5402 *\n  1930 1936  -62.5662     0.1788      -63.0986    -62.0339 *\n  1930 1937  -72.0068     0.1972      -72.5939    -71.4197 *\n  1930 1938  -81.4286     0.1729      -81.9433    -80.9139 *\n  1930 1939  -90.9991     0.1778      -91.5282    -90.4699 *\n  1930 1940 -100.5054     0.1684     -101.0066   -100.0041 *\n  1930 1941 -110.0626     0.1939     -110.6397   -109.4855 *\n  1930 1942 -119.5859     0.1834     -120.1319   -119.0400 *\n  1930 1943 -128.7728     0.1646     -129.2628   -128.2829 *\n  1930 1944 -138.5393     0.1925     -139.1123   -137.9662 *\n  1930 1945 -147.3045     0.6258     -149.1671   -145.4419 *\n  1930 1946 -153.3012     1.7079     -158.3848   -148.2176 *\n  1930 1947 -155.4146     2.5608     -163.0371   -147.7922 *\n  1930 1948 -156.4254     3.5432     -166.9720   -145.8788 *\n  1930 1949 -157.3936     4.8064     -171.7002   -143.0869 *\n  1930 1950 -157.8580     5.5374     -174.3407   -141.3752 *\n  1940 1929    0.0936     0.1719       -0.4181      0.6052  \n  1940 1930   -0.0890     0.1537       -0.5465      0.3685  \n  1940 1931   -0.0531     0.1312       -0.4436      0.3373  \n  1940 1932   -0.0708     0.1724       -0.5839      0.4422  \n  1940 1933    0.1635     0.1834       -0.3823      0.7093  \n  1940 1934   -0.1662     0.1897       -0.7307      0.3984  \n  1940 1935    0.1361     0.2203       -0.5196      0.7918  \n  1940 1936   -0.1257     0.1343       -0.5253      0.2740  \n  1940 1937    0.0528     0.1113       -0.2785      0.3841  \n  1940 1938    0.0520     0.1500       -0.3945      0.4986  \n  1940 1939   -0.0745     0.1442       -0.5037      0.3548  \n  1940 1940   -5.9533     0.1389       -6.3668     -5.5399 *\n  1940 1941   -8.8656     0.1374       -9.2745     -8.4567 *\n  1940 1942  -12.1226     0.1169      -12.4707    -11.7746 *\n  1940 1943  -15.2611     0.1710      -15.7700    -14.7522 *\n  1940 1944  -18.3218     0.1703      -18.8288    -17.8148 *\n  1940 1945  -21.5040     0.1557      -21.9674    -21.0405 *\n  1940 1946  -24.7642     0.1004      -25.0630    -24.4654 *\n  1940 1947  -28.0626     0.1759      -28.5860    -27.5391 *\n  1940 1948  -31.2050     0.1282      -31.5865    -30.8234 *\n  1940 1949  -34.2653     0.1664      -34.7607    -33.7700 *\n  1940 1950  -37.2604     0.1796      -37.7949    -36.7258 *\n  1945 1929   -0.0499     0.1948       -0.6297      0.5298  \n  1945 1930    0.0854     0.1568       -0.3814      0.5522  \n  1945 1931   -0.0652     0.1691       -0.5685      0.4380  \n  1945 1932    0.0584     0.1520       -0.3941      0.5109  \n  1945 1933    0.1273     0.1764       -0.3978      0.6523  \n  1945 1934   -0.3087     0.2161       -0.9521      0.3346  \n  1945 1935    0.0931     0.1753       -0.4288      0.6150  \n  1945 1936   -0.0245     0.1531       -0.4803      0.4314  \n  1945 1937    0.0219     0.1328       -0.3735      0.4173  \n  1945 1938    0.0697     0.1471       -0.3680      0.5074  \n  1945 1939    0.0888     0.1344       -0.3112      0.4888  \n  1945 1940   -0.3148     0.1643       -0.8039      0.1743  \n  1945 1941    0.0687     0.1755       -0.4538      0.5912  \n  1945 1942   -0.0414     0.1659       -0.5352      0.4524  \n  1945 1943    0.1171     0.1588       -0.3555      0.5896  \n  1945 1944    0.0100     0.1841       -0.5380      0.5580  \n  1945 1945   -5.8570     0.1712       -6.3665     -5.3476 *\n  1945 1946   -6.9736     0.2105       -7.6001     -6.3470 *\n  1945 1947   -8.6008     0.2393       -9.3132     -7.8884 *\n  1945 1948   -9.5597     0.1792      -10.0930     -9.0264 *\n  1945 1949  -10.7292     0.1795      -11.2634    -10.1950 *\n  1945 1950  -12.1077     0.1911      -12.6766    -11.5388 *\n---\nSignif. codes: `*' confidence band does not cover 0\n\nP-value for pre-test of parallel trends assumption:  0\nControl Group:  Never Treated,  Anticipation Periods:  0\nEstimation Method:  Doubly Robust\n```\n:::\n\n```{.r .cell-code}\nmw.dyn <- aggte(example_attgt, type = \"dynamic\")\nsummary(mw.dyn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\naggte(MP = example_attgt, type = \"dynamic\")\n\nReference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> \n\n\nOverall summary of ATT's based on event-study/dynamic aggregation:  \n      ATT    Std. Error     [ 95%  Conf. Int.]  \n -86.2077        1.6384    -89.419    -82.9964 *\n\n\nDynamic Effects:\n Event time  Estimate Std. Error [95% Simult.  Conf. Band]  \n        -16   -0.0499     0.1985       -0.6064      0.5065  \n        -15    0.0854     0.1662       -0.3804      0.5512  \n        -14   -0.0652     0.1641       -0.5251      0.3946  \n        -13    0.0584     0.1461       -0.3510      0.4677  \n        -12    0.1273     0.1880       -0.3995      0.6540  \n        -11   -0.1076     0.1454       -0.5152      0.3000  \n        -10    0.0021     0.1223       -0.3408      0.3449  \n         -9   -0.0388     0.1095       -0.3457      0.2681  \n         -8   -0.0245     0.1082       -0.3278      0.2789  \n         -7    0.1166     0.1056       -0.1792      0.4124  \n         -6   -0.0387     0.1177       -0.3686      0.2912  \n         -5   -0.0894     0.1456       -0.4974      0.3187  \n         -4   -0.0285     0.1244       -0.3772      0.3202  \n         -3    0.0057     0.0989       -0.2716      0.2830  \n         -2    0.0845     0.1284       -0.2753      0.4444  \n         -1   -0.0011     0.0923       -0.2598      0.2576  \n          0   -5.8774     0.0989       -6.1545     -5.6003 *\n          1  -10.2911     0.6179      -12.0229     -8.5593 *\n          2  -15.1112     1.2650      -18.6562    -11.5661 *\n          3  -19.6681     1.8362      -24.8141    -14.5222 *\n          4  -24.2980     2.4475      -31.1569    -17.4391 *\n          5  -28.9264     3.0104      -37.3629    -20.4899 *\n          6  -43.6652     4.9456      -57.5251    -29.8053 *\n          7  -50.0347     4.5586      -62.8101    -37.2593 *\n          8  -56.3168     6.5183      -74.5840    -38.0496 *\n          9  -62.6322     5.7624      -78.7810    -46.4834 *\n         10  -68.8829     6.4792      -87.0405    -50.7252 *\n         11 -110.0626     0.2220     -110.6848   -109.4403 *\n         12 -119.5859     0.1875     -120.1114   -119.0605 *\n         13 -128.7728     0.1829     -129.2853   -128.2604 *\n         14 -138.5393     0.1825     -139.0506   -138.0279 *\n         15 -147.3045     0.6075     -149.0070   -145.6020 *\n         16 -153.3012     1.7299     -158.1492   -148.4532 *\n         17 -155.4146     2.5428     -162.5408   -148.2885 *\n         18 -156.4254     3.4099     -165.9816   -146.8692 *\n         19 -157.3936     4.5812     -170.2321   -144.5550 *\n         20 -157.8580     5.7055     -173.8474   -141.8685 *\n---\nSignif. codes: `*' confidence band does not cover 0\n\nControl Group:  Never Treated,  Anticipation Periods:  0\nEstimation Method:  Doubly Robust\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nes <- aggte(example_attgt, type = \"dynamic\")\nggdid(es)\n```\n\n::: {.cell-output-display}\n![](ajph-did-example_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "ajph-did-example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}